# Complete Deployment Guide for Library Management System

This guide provides detailed instructions for deploying the Library Management System with both backend (FastAPI) and frontend (GitHub Pages) components.

## Table of Contents
1. [Overview](#overview)
2. [Prerequisites](#prerequisites)
3. [Backend Deployment](#backend-deployment)
4. [Frontend Deployment to GitHub Pages](#frontend-deployment-to-github-pages)
5. [Configuration](#configuration)
6. [Troubleshooting](#troubleshooting)

## Overview

The Library Management System consists of:
- Backend: FastAPI application with database
- Frontend: Static HTML/JS application deployed on GitHub Pages

The frontend connects to the backend API to provide full functionality for managing books, readers, and borrowing operations.

## Prerequisites

- GitHub account
- Git installed locally
- Backend hosting solution (Heroku, Railway, VPS, etc.)
- Basic understanding of FastAPI and GitHub Pages

## Backend Deployment

### Option 1: Deploy to Heroku

1. Create a free Heroku account
2. Install Heroku CLI
3. Clone the repository:
   ```bash
   git clone https://github.com/your-username/your-repo-name.git
   cd your-repo-name
   ```

4. Create a new Heroku app:
   ```bash
   heroku create your-app-name
   ```

5. Set environment variables:
   ```bash
   heroku config:set SECRET_KEY="your-very-secret-key"
   heroku config:set ALGORITHM="HS256"
   heroku config:set ACCESS_TOKEN_EXPIRE_MINUTES=30
   ```

6. Deploy the application:
   ```bash
   git push heroku main
   ```

7. Run database migrations:
   ```bash
   heroku run alembic upgrade head
   ```

### Option 2: Deploy to Railway

1. Create a Railway account
2. Connect your GitHub repository
3. Add environment variables in Railway dashboard:
   - SECRET_KEY
   - ALGORITHM
   - ACCESS_TOKEN_EXPIRE_MINUTES
4. Deploy the application
5. Run migrations using Railway console

### Option 3: Self-hosted Deployment

1. Set up a server with Python 3.8+
2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```
3. Set environment variables
4. Set up database (PostgreSQL recommended)
5. Run migrations:
   ```bash
   alembic upgrade head
   ```
6. Run the application:
   ```bash
   uvicorn app.main:app --host 0.0.0.0 --port 8000
   ```

## Frontend Deployment to GitHub Pages

### Method 1: Using GitHub Actions (Recommended)

1. Create `.github/workflows/deploy.yml` in your repository:

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '16'
        
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./docs
        publish_branch: gh-pages
```

2. In your repository settings:
   - Go to Settings → Pages
   - Select source as "Deploy from a branch"
   - Choose `gh-pages` branch
   - Click Save

### Method 2: Manual Deployment

1. Ensure your `/docs` folder contains:
   - `index.html` - Main application
   - `404.html` - Error page
   - `.nojekyll` - Disable Jekyll processing
   - Any other static assets

2. In your repository settings:
   - Go to Settings → Pages
   - Select source as "Deploy from a branch"
   - Choose `main` branch with `/docs` folder
   - Click Save

## Configuration

### Backend Configuration

Set these environment variables:

```bash
SECRET_KEY="your-super-secret-key-at-least-32-characters-long"
ALGORITHM="HS256"
ACCESS_TOKEN_EXPIRE_MINUTES=30
DATABASE_URL="postgresql://user:password@host:port/database"  # For production
```

### Frontend Configuration

The frontend allows dynamic API URL configuration:

1. After deploying to GitHub Pages, visit your site
2. In the API Configuration section, enter your backend URL
3. Click "Save URL" to store it in browser's localStorage
4. The frontend will now connect to your backend

## Connecting Frontend and Backend

1. Deploy your backend and note the base URL (e.g., `https://your-app.herokuapp.com`)
2. Deploy your frontend to GitHub Pages
3. Access your GitHub Pages site
4. Enter your backend URL in the API Configuration section
5. Register your first admin user via the registration form
6. Start using the complete system

## Troubleshooting

### GitHub Actions Permission Error

If you encounter permission errors like:
```
remote: Permission to username/repo.git denied to github-actions[bot].
```

This means the GitHub Actions workflow doesn't have permission to push to the gh-pages branch. To fix:

1. Go to repository Settings → Actions → General
2. Under "Workflow permissions", select "Read and write permissions"
3. Check "Allow GitHub Actions to create and approve pull requests"
4. Save changes
5. Re-run the workflow

### CORS Issues

If you encounter CORS errors, ensure your backend allows requests from your GitHub Pages domain:

In `app/main.py`, update CORS settings:
```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://yourusername.github.io", "http://localhost:8000"],  # Add your GitHub Pages URL
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### API Connection Issues

If the frontend can't connect to the backend:

1. Verify the backend is running and accessible
2. Check that you've entered the correct API URL (include `http://` or `https://`)
3. Ensure your backend allows CORS from your frontend domain
4. Check browser developer tools for specific error messages

## Security Considerations

1. Use strong, unique SECRET_KEY values
2. Use HTTPS for production deployments
3. Regularly rotate your SECRET_KEY
4. Implement proper rate limiting
5. Validate and sanitize all user inputs

## Maintenance

1. Regularly update dependencies
2. Monitor application logs
3. Backup your database regularly
4. Keep your SECRET_KEY secure and rotate periodically

## Support

For issues with the deployment process, check:

1. GitHub Actions logs for build errors
2. Browser console for frontend errors
3. Backend application logs for API errors
4. Ensure all environment variables are correctly set